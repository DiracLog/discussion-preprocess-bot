class PromptBuilder:

    @staticmethod
    def build_chunk_prompt(chunk: str) -> str:
        return f"""[INST]
        АНАЛІЗ СЕГМЕНТУ (Raw Data Extraction).
    
        Текст може містити помилки розпізнавання мовлення — інтерпретуй зміст максимально точно.
    
        Виділи всі згадки творів (книги, фільми, ігри).
        Для кожної згадки визнач:
        - speaker (якщо не впевнений — зроби найкраще припущення)
        - title (якщо назва неточна — віднови змістово)
        - mentioned score (якщо є)
        - arguments (короткі ключові тези)
    
        ЗАВЖДИ повертай хоча б один запис, якщо в тексті є обговорення твору.
    
        Поверни ТІЛЬКИ JSON:
    
        {{
          "notes": [
            {{
              "speaker": "Ім'я",
              "title": "Назва твору",
              "score_mentioned": "8/10 або текст",
              "arguments": ["..."]
            }}
          ]
        }}
    
        Якщо нічого не знайдено:
        {{ "notes": [] }}
    
        ТЕКСТ:
        {chunk}
        [/INST]"""

    @staticmethod
    def build_main_prompt(text: str, is_notes: bool) -> str:
        input_desc = (
            "Це попередньо зібрані нотатки (витягнуті факти) з довгої розмови."
            if is_notes
            else "Це сира стенограма розмови."
        )

        return f"""[INST]
        Ти — аналітик книжкового клубу.
        {input_desc}
    
        Текст може містити помилки розпізнавання мовлення — інтерпретуй зміст максимально точно.
    
        ТВОЄ ЗАВДАННЯ:
    
        1. Знайти всі обговорені твори (теми).
        2. ЗГРУПУВАТИ всі згадки одного твору в один topic.
           Якщо назва не зовсім точна — зроби найкраще припущення.
           ЗАВЖДИ повертай хоча б один topic, якщо розмова містить обговорення твору.
        3. Для кожного topic створити список discussions.
        4. Кожен speaker повинен мати ОКРЕМИЙ discussion.
        5. НЕ змішуй аргументи різних людей.
        6. Якщо один speaker говорив кілька разів — об'єднай його аргументи.
    
        ФОРМАТ ВИВОДУ — ТІЛЬКИ валідний JSON:
    
        {{
          "topics": [
            {{
              "title": "Назва твору",
              "type": "book/movie/game/series",
              "discussions": [
                {{
                  "speaker": "Ім'я",
                  "sentiment": "positive/negative/mixed",
                  "arguments": ["Аргумент 1", "..."],
                  "mark": 8.5,
                  "is_inferred_score": true
                }}
              ]
            }}
          ]
        }}
    
        ТЕКСТ:
        {text}
        [/INST]"""



